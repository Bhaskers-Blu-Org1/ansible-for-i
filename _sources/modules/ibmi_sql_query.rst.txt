..
.. SPDX-License-Identifier: Apache-2.0
..

:github_url: https://github.com/LiJunBJZhu/i_collection_core/tree/master/plugins/modules/ibmi_sql_query.py


ibmi_sql_query -- Executes a SQL DQL(Data Query Language) statement on a remote IBMi node.
==========================================================================================

.. contents::
   :local:
   :depth: 1


Synopsis
--------

The ``ibmi_sql_query`` module takes the SQL DQL(Data Query Language) statement as argument.

The given SQL DQL(Data Query Language) statement will be executed on all selected nodes.

Only run one statement at a time.






Parameters
----------

  database (optional, str, *SYSBAS)
    Specified database name, usually, its the iasp name, use WRKRDBDIRE to check Relational Database Directory Entries

    Default to use the '*LOCAL' entry


  expected_row_count (optional, int, -1)
    The expected row count

    If it is equal or greater than 0, check if the actual row count returned from the query statement is matched with the expected row count

    If it is less than 0, do not check if the actual row count returned from the query statement is matched with the expected row counit


  sql (True, str, None)
    The ``ibmi_sql_query`` module takes a IBM i SQL DQL(Data Query Language) statement to run.


  joblog (optional, bool, False)
    If set to ``true``, output the JOBLOG even success.





Notes
-----

.. note::
   - Hosts file needs to specify ansible_python_interpreter=/QOpenSys/pkgs/bin/python3(or python2)


See Also
--------

.. seealso::

   :ref:`ibmi_sql_execute_module`
      The official documentation on the **ibmi_sql_execute** module.


Examples
--------

.. code-block:: yaml+jinja

    
    - name: Query the data of table Persons
      ibmi_sql_query:
        sql: 'select * from Persons'



Return Values
-------------

  stderr_lines (When rc as non-zero(failure), list, [''])
    The sql statement standard error split in lines


  end (always, str, 2019-12-02 11:07:54.064969)
    The sql statement execution end time


  job_log (when rc as non-zero(failure) or rc as success(0) but joblog set to true, str, [{'TO_MODULE': 'QSQSRVR', 'TO_PROGRAM': 'QSQSRVR', 'MESSAGE_TEXT': 'Printer device PRT01 not found.', 'FROM_MODULE': '', 'FROM_PROGRAM': 'QWTCHGJB', 'MESSAGE_TIMESTAMP': '2020-05-20-21.41.40.845897', 'FROM_USER': 'CHANGLE', 'TO_INSTRUCTION': '9369', 'MESSAGE_SECOND_LEVEL_TEXT': 'Cause . . . . . :   This message is used by application programs as a general escape message.', 'MESSAGE_TYPE': 'DIAGNOSTIC', 'MESSAGE_ID': 'CPD0912', 'MESSAGE_LIBRARY': 'QSYS', 'FROM_LIBRARY': 'QSYS', 'SEVERITY': '20', 'FROM_PROCEDURE': '', 'TO_LIBRARY': 'QSYS', 'FROM_INSTRUCTION': '318F', 'MESSAGE_SUBTYPE': '', 'ORDINAL_POSITION': '5', 'MESSAGE_FILE': 'QCPFMSG', 'TO_PROCEDURE': 'QSQSRVR'}])
    the job_log


  stdout (When rc as non-zero(failure), str, )
    The sql statement standard output


  rc (always, int, 0)
    The sql statement return code (0 means success)


  start (always, str, 2019-12-02 11:07:53.757435)
    The sql statement execution start time


  delta (always, str, 0:00:00.307534)
    The sql statement execution delta time


  stderr (When rc as non-zero(failure), str, )
    The sql statement standard error


  sql (always, str, select * from Persons)
    The sql statement executed by the task


  stdout_lines (When rc as non-zero(failure), list, [''])
    The sql statement standard output split in lines


  row (when rc as 0(success), list, [{'LASTNAME': 'Le', 'ID_P': '919665', 'ADDRESS': 'Ring Building', 'FIRSTNAME': 'Chang', 'CITY': 'Beijing'}, {'LASTNAME': 'Li', 'ID_P': '919689', 'ADDRESS': 'Ring Building', 'FIRSTNAME': 'Zhang', 'CITY': 'Shanhai'}])
    The sql query statement result





Status
------




- This module is not guaranteed to have a backwards compatible interface. *[preview]*


- This module is maintained by community.



Authors
~~~~~~~

- Chang Le(@changlexc)

